# 行为驱动开发文档 (BDD)

> **模板版本**: v1.0.0 | **最后更新**: 2025-10-31

## 1. 文档信息
- **功能名称**: [功能名称]
- **关联 PRD**: [PRD 文档链接]
- **文档版本**: v1.0
- **创建日期**: [YYYY-MM-DD]
- **负责人**: [姓名]
- **状态**: [草稿 / 评审中 / 已批准 / 已实现]

---

## 2. 功能概述

### 2.1 功能描述
[简要描述该功能的核心价值和目标]

### 2.2 业务价值
[说明该功能为用户和业务带来的价值]

### 2.3 关联需求
- PRD 章节: [章节编号]
- 用户故事 ID: [如有]
- 优先级: [P0 / P1 / P2]

---

## 3. 用户角色定义

| 角色 | 描述 | 权限 | 使用场景 |
|------|------|------|---------|
| [角色1] | [角色描述] | [权限说明] | [典型场景] |
| [角色2] | [角色描述] | [权限说明] | [典型场景] |

---

## 4. 业务规则

### 4.1 核心规则
1. [规则 1]
2. [规则 2]
3. [规则 3]

### 4.2 约束条件
- [约束 1]
- [约束 2]

---

## 5. 功能场景（Gherkin 格式）

### Feature: [功能名称]

**作为** [用户角色]
**我想要** [完成的操作]
**以便** [达到的目标]

---

#### Background: 场景背景
```gherkin
Given [系统的初始状态]
And [其他前置条件]
```

---

#### Scenario 1: [场景名称 - 正常流程]

**场景描述**: [简要说明该场景]

```gherkin
Given [前置条件 1]
  And [前置条件 2]
When [用户执行的操作]
  And [其他相关操作]
Then [预期的系统响应]
  And [其他预期结果]
```

**示例数据**:
| 输入字段 | 示例值 | 说明 |
|---------|--------|------|
| [字段1] | [值] | [说明] |
| [字段2] | [值] | [说明] |

**预期结果**:
| 输出字段 | 预期值 | 说明 |
|---------|--------|------|
| [字段1] | [值] | [说明] |

---

#### Scenario 2: [场景名称 - 边界条件]

**场景描述**: [简要说明该场景]

```gherkin
Given [前置条件]
When [用户执行边界操作]
Then [系统的边界处理行为]
```

---

#### Scenario 3: [场景名称 - 异常处理]

**场景描述**: [简要说明该场景]

```gherkin
Given [前置条件]
When [用户执行异常操作]
Then [系统显示错误信息]
  And [系统状态保持不变]
  But [不应该发生的情况]
```

**错误信息示例**:
- 错误码: [CODE]
- 错误信息: [错误提示文案]
- 建议操作: [用户应如何处理]

---

#### Scenario 4: [场景名称 - 权限控制]

**场景描述**: [简要说明该场景]

```gherkin
Given [用户身份/权限设置]
When [用户尝试执行操作]
Then [根据权限展示不同结果]
```

---

## 6. 场景矩阵（Scenario Outline）

### 场景模板: [场景名称]

```gherkin
Scenario Outline: [场景模板名称]
  Given [前置条件使用 <参数>]
  When [操作使用 <参数>]
  Then [预期结果使用 <参数>]

Examples:
  | 参数1 | 参数2 | 预期结果 |
  | 值1   | 值2   | 结果1   |
  | 值3   | 值4   | 结果2   |
  | 值5   | 值6   | 结果3   |
```

---

## 7. 非功能性行为

### 7.1 性能行为
```gherkin
Scenario: 性能要求
  Given 系统处于正常负载
  When [执行特定操作]
  Then 响应时间应该在 [X] 秒内
    And 系统 CPU 使用率应低于 [Y]%
```

### 7.2 安全行为
```gherkin
Scenario: 安全验证
  Given 用户未登录
  When 尝试访问受保护资源
  Then 系统应该重定向到登录页
    And 不应该暴露任何敏感信息
```

### 7.3 兼容性行为
```gherkin
Scenario: 跨平台兼容
  Given 用户在 [平台/浏览器]
  When 执行 [操作]
  Then 功能应该正常工作
    And 界面显示应该正常
```

---

## 8. 数据验证规则

### 8.1 输入验证
| 字段名 | 数据类型 | 必填 | 长度/范围 | 格式要求 | 错误提示 |
|--------|---------|------|-----------|---------|---------|
| [字段] | [类型] | 是/否 | [范围] | [格式] | [提示] |

### 8.2 业务验证
```gherkin
Scenario: 业务规则验证
  Given [数据状态]
  When [执行业务操作]
  Then [系统验证规则]
    And [通过/拒绝操作]
```

---

## 9. 集成场景

### 9.1 外部系统集成
```gherkin
Scenario: 第三方服务调用
  Given 第三方服务正常
  When 系统调用 [API 名称]
  Then 应该收到 [预期响应]
    And 系统应该记录调用日志
```

### 9.2 系统间交互
```gherkin
Scenario: 模块间协作
  Given [模块 A] 的状态是 [状态]
  When [模块 B] 触发 [事件]
  Then [模块 A] 应该接收通知
    And 更新状态为 [新状态]
```

---

## 10. 验收标准

### 10.1 功能验收
- [ ] 所有 Scenario 均通过测试
- [ ] 边界条件处理正确
- [ ] 异常场景有合理处理
- [ ] 权限控制符合预期

### 10.2 体验验收
- [ ] 用户操作流畅自然
- [ ] 错误提示清晰友好
- [ ] 响应时间符合要求
- [ ] 界面显示正确

### 10.3 技术验收
- [ ] 代码覆盖率达到 [X]%
- [ ] 自动化测试全部通过
- [ ] 性能指标达标
- [ ] 无安全漏洞

---

## 11. 测试数据准备

### 11.1 正常数据
```json
{
  "字段1": "值1",
  "字段2": "值2"
}
```

### 11.2 边界数据
```json
{
  "字段1": "最小值/最大值",
  "字段2": "空值/超长值"
}
```

### 11.3 异常数据
```json
{
  "字段1": "非法格式",
  "字段2": "不存在的引用"
}
```

---

## 12. 依赖关系

### 12.1 前置功能
- [功能 A]: [依赖说明]
- [功能 B]: [依赖说明]

### 12.2 后续功能
- [功能 C]: [基于本功能扩展]

---

## 13. 实现说明

### 13.1 技术实现要点
- [要点 1]
- [要点 2]

### 13.2 建议的测试工具
- 单元测试: [工具名称]
- 集成测试: [工具名称]
- E2E 测试: [工具名称]
- BDD 框架: [Cucumber / Jest-Cucumber / Behave]

### 13.3 自动化测试
```
功能文件路径: features/[功能名].feature
步骤定义路径: step_definitions/[功能名]_steps.js
测试数据路径: fixtures/[功能名]_data.json
```

---

## 14. 附录

### 14.1 术语表
| 术语 | 定义 |
|------|------|
| [术语1] | [定义] |

### 14.2 参考资料
- PRD 文档: [链接]
- API 文档: [链接]
- 设计稿: [链接]

### 14.3 变更记录
| 版本 | 日期 | 修改人 | 修改内容 | 影响的场景 |
|------|------|--------|---------|-----------|
| v1.0 | [日期] | [姓名] | 初始版本 | - |

---

## Gherkin 语法速查

### 关键词说明
- **Feature**: 功能描述
- **Background**: 所有场景的公共前置条件
- **Scenario**: 具体测试场景
- **Scenario Outline**: 场景模板（数据驱动）
- **Given**: 前置条件（系统状态）
- **When**: 触发动作（用户操作）
- **Then**: 预期结果（系统响应）
- **And**: 额外的相同类型步骤
- **But**: 例外情况
- **Examples**: 场景模板的数据表

### 最佳实践
1. 每个 Scenario 应该独立且可单独执行
2. 使用业务语言，避免技术细节
3. Given 描述状态，不描述动作
4. When 只描述单一动作
5. Then 验证业务结果，不验证技术实现
6. 保持场景简洁，一个场景测试一个行为
